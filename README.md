# **Техническое задание: DocSynth**

## 1. Общая информация

### **Название проекта**

**DocSynth — интеллектуальный агрегатор документации с RAG-архитектурой.**

### **Краткое описание**

Система автоматически собирает информацию из нескольких страниц технической документации и формирует связный, понятный итоговый ответ.
Предназначена для разработчиков и инженеров, работающих с большими объемами документации, чтобы сократить время поиска и изучения информации.


---

## 2. Архитектура и стек

### **Общая схема**

```
                ┌───────────────────────────┐
                │        Frontend           │
                │ React + WebSocket stream  │
                └───────────────┬───────────┘
                                │
                                ▼
┌──────────────────────────────────────────────────────────┐
│                     Backend API (Spring Boot)            │
│  Auth, users, docs, history, question-handling           │
└──────────────┬───────────────────────┬───────────────────┘
               │                       │
               │                       ▼
               │             ┌──────────────────┐
               │             │   RAG Service    │
               │             │ Vector search,   │
               │             │ LLM orchestration│
               │             └──────┬───────────┘
               │                    │
               ▼                    ▼
    ┌────────────────┐    ┌─────────────────────┐
    │ PostgreSQL     │    │ pgvector store      │
    │ Docs, history  │    │ Embeddings, chunks  │
    └────────────────┘    └─────────────────────┘
                                    ▲
                                    │
                          ┌────────────────────┐
                          │ Indexing Service   │
                          │ chunking, embed,   │
                          │ sync docs          │
                          └────────────────────┘

```

### **Backend**

* Kotlin + Spring Boot + WebFlux
* REST API + WebSocket для стриминга ответа
* PostgreSQL — хранение документов, пользователей, истории
* JWT-аутентификация

Функции:

* управление документами,
* просмотр статуса индексации,
* история запросов,
* делегирование вопросов в RAG-сервис.

### **RAG сервис**

Отдельный микросервис, содержащий:

* генерацию embedding'ов,
* векторный поиск (pgvector),
* retrieval-pipeline,
* вызовы LLM (OpenAI/Anthropic/локальная модели),
* стриминг токенов.

### **Векторное хранилище**

* PostgreSQL + pgvector
  или
* Qdrant / Weaviate / Milvus

### **Сервис индексации**

Микросервис или CronJob, отвечающий за:

* импорт документов,
* разбор и нормализацию текста,
* chunking,
* embeddings,
* обновление векторного индекса.

---

## 3. Пользовательские роли

### **Пользователь**

* задаёт вопросы,
* просматривает документы,
* может загружать документы (опционально),
* видит список фрагментов, использованных в ответе,
* просматривает историю запросов.

### **Администратор**

* управление пользователями,
* настройки источников документации,
* запуск полной и выборочной индексации,
* просмотр статистики работы системы,
* диагностика ошибок индексации и LLM.

---

## 4. Основные сценарии использования (User Stories)

* **US-1:** Как разработчик, я хочу задать вопрос и получить связный ответ из нескольких страниц документации.
* **US-2:** Как разработчик, я хочу видеть ссылки на использованные документы.
* **US-3:** Как администратор, я хочу загружать или синхронизировать документацию.
* **US-4:** Как пользователь, я хочу видеть историю запросов.
* **US-5:** Как администратор, я хочу вручную запускать индексацию.
* **US-6:** Как пользователь, я хочу фильтровать документы по типу.
* **US-7:** Как администратор, я хочу видеть прогресс индексации.
* **US-8:** Как разработчик, я хочу видеть фрагменты текста, использованные в ответе.

---

## 5. Функциональные требования

### **5.1 Backend**

* FR-BE-1: Загрузка документов (Markdown, TXT, HTML).
* FR-BE-2: Разбиение и индексация документов.
* FR-BE-3: Поиск релевантных фрагментов.
* FR-BE-4: Генерация итогового ответа с помощью LLM.
* FR-BE-5: API возвращает список источников.
* FR-BE-6: Ведение истории запросов.
* FR-BE-7: JWT авторизация + роли.
* FR-BE-8: Администратор может запускать реиндексацию.
* FR-BE-9: Поддержка стриминга токенов (WebSocket/SSE).
* FR-BE-10: Backend передаёт вопросы в RAG-сервис и агрегирует ответ.
* FR-BE-11: Документы хранятся с метаданными.
* FR-BE-12: История запроса сохраняет использованные chunk-и.

### **5.2 Frontend**

* FR-FE-1: Поле ввода вопросов.
* FR-FE-2: Стриминг ответа.
* FR-FE-3: Просмотр документов.
* FR-FE-4: История запросов.
* FR-FE-5: Управление источниками документации (админ).
* FR-FE-6: Показ ссылок на используемые документы.
* FR-FE-7: Показ прогресса генерации (逐 token).
* FR-FE-8: Подсветка текста фрагментов.
* FR-FE-9: UI уведомления об устаревшей индексации.

### **5.3 Микросервисы**

* FR-MS-1: Индексация должна обновлять embeddings.
* FR-MS-2: Импорт новых версий документации.
* FR-MS-3: Очередь задач индексации.
* FR-MS-4: Поддержка разных embedding-моделей.
* FR-MS-5: RAG pipeline:

---

## 6. Нефункциональные требования

### **Производительность**

* Поиск по векторной базе: < 150 мс
* Генерация ответа зависит от LLM, ответ должен стримиться
* Индексация крупной документации — асинхронная и безопасная

### **Надёжность**

* Падение LLM не влияет на работу остальных функций
* Восстановление индекса при ошибках

### **Безопасность**

* JWT
* Контроль ролей
* Документы хранятся в защищённом хранилище
* В LLM не отправляется весь документ, только релевантные фрагменты

### **Мониторинг**

* Логи запросов/ответов
* Ошибки LLM
* Метрики индексации
* Prometheus + Grafana

### **UX**

* Минимальный и быстрый интерфейс
* Понятные ошибки
* Подсветка фрагментов документации

---

## 7. Ограничения и допущения

* Проект внутренний
* Документы не содержат секретных данных
* Поддерживается только веб-клиент
* MVP → только Markdown
* Один документ ≤ 5 MB
* Indexing Service может использовать внешние embedding API

---

## 8. Критерии готовности / проверки

### **Что должно быть**

* Полная RAG-цепочка:
  *вопрос → поиск → генерация → стриминг ответа*
* Успешная индексация документов
* Клиент видит использованные источники
* История запросов работает
* Ошибки индексации видны в UI

### **Примерный тестовый сценарий**

1. Администратор загружает документ.
2. Индексация запускается → видно состояние.
3. Пользователь авторизуется.
4. Отправляет вопрос.
5. Получает ответ + ссылки на фрагменты.
6. Открывает документ.
7. История запроса доступна в профиле.
